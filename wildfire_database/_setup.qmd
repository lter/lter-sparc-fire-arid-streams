```{r}
#| include: false

library(RPostgreSQL)

pg_wildfire_connect <- function(
  this_user = NULL,
  db        = "wildfire_dev",
  this_host = "localhost"
) {

  connection <- DBI::dbConnect(
    drv      = DBI::dbDriver("PostgreSQL"),
    user     = this_user,
    dbname   = db,
    host     = this_host,
    password = Sys.getenv("POSTGRES")
  )

  return(connection)

}

pg <- pg_wildfire_connect(
  this_user = params$user,
  db        = params$db,
  this_host = params$host
)

# Cleanly disconnect when the render ends
on.exit({
  if (exists("pg", inherits = FALSE)) {
    ok <- FALSE
    try(ok <- DBI::dbIsValid(pg), silent = TRUE)
    if (isTRUE(ok)) DBI::dbDisconnect(pg)
  }
}, add = TRUE)

```
